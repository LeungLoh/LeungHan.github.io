<!DOCTYPE html><html data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>深度学习环境搭建 | 特立独型</title><meta name="description" content="深度学习环境搭建"><meta name="keywords" content="环境搭建"><meta name="author" content="特立独型"><meta name="copyright" content="特立独型"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="深度学习环境搭建"><meta name="twitter:description" content="深度学习环境搭建"><meta name="twitter:image" content="leunghan.github.io/img/深度学习/环境搭建/cover.jpg"><meta property="og:type" content="article"><meta property="og:title" content="深度学习环境搭建"><meta property="og:url" content="leunghan.github.io/2019/04/19/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"><meta property="og:site_name" content="特立独型"><meta property="og:description" content="深度学习环境搭建"><meta property="og:image" content="leunghan.github.io/img/深度学习/环境搭建/cover.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="leunghan.github.io/2019/04/19/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"><link rel="prev" title="JavaSE（一）：语言基础" href="/leunghan.github.io/2019/12/22/JavaSE%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/"><link rel="next" title="记2018暑期夏令营——东华大学&amp;重庆大学" href="/leunghan.github.io/2018/07/16/%E8%AE%B02018%E6%9A%91%E6%9C%9F%E5%A4%8F%E4%BB%A4%E8%90%A5%E2%80%94%E2%80%94%E4%B8%9C%E5%8D%8E%E5%A4%A7%E5%AD%A6&amp;%E9%87%8D%E5%BA%86%E5%A4%A7%E5%AD%A6/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.1.1"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">特立独型</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">12</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">5</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">4</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(/img/深度学习/环境搭建/cover.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">深度学习环境搭建</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2019-04-19<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2019-12-21</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p>记录搭建深度学习环境，并安装测试YOLO v3和Faster R-CNN</p>
<a id="more"></a>
<p><strong>Ubuntu 16.04下深度学习环境搭建</strong><br><strong><em>一、安装环境</em></strong><br>本片博客的的环境均在宏碁E5-572G笔记本下搭建完成，具体配置如下：<br>操作系统：Ubuntu 16.04<br>处理器：Inter(R) Core(TM) i5-4210M CPU<br>显卡：NVIDIA@GeForce GT940M 2G<br>内存：DDR3 8G</p>
<p><strong><em>二、NVIDIA显卡驱动安装</em></strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nvidia-384</span><br></pre></td></tr></table></figure></div>
<p>重启（可能也不需要），测试</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nvidia-smi</span><br></pre></td></tr></table></figure></div>

<p><strong><em>三、CUDA模块安装</em></strong><br><strong>==CUDA下载==</strong><br>我这里选择cuda-8.0.44进行下载。这个是下载cuda的链接地址：<br><a href="https://developer.nvidia.com/cuda-80-download-archive" target="_blank" rel="noopener">https://developer.nvidia.com/cuda-80-download-archive</a><br>下载下来的文件放到/home目录下，也可以选择适合自己电脑的CUDA版本进行下载<br><a href="/img/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/CUDA.jpg" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/img/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/CUDA.jpg" class="lazyload" title></a><br><strong>==CUDA安装==</strong><br>在CUDA下载路径下，执行下面的命令进行安装：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sh cuda_8.0.44_linux.run</span><br></pre></td></tr></table></figure></div>
<p>注意：在安装的时候首先要一直按enter键完成安装文档的阅读，然后选择accept接下来会出现让你选择是否安装nvidia361驱动，因为前面驱动已经安装好了，所以这里要选择no，不安装默认驱动</p>
<p><strong>==CUDA环境配置==</strong><br>打开~/.bashrc文件，并添加3句命令到文件的末尾。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo vim ~&#x2F;.bashrc         #打开.bashrc文件</span><br><span class="line"></span><br><span class="line">export CUDA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;cuda-8.0    #将export这3句添加到文件的末尾。</span><br><span class="line">export PATH&#x3D;$PATH:$&#123;CUDA_HOME&#125;&#x2F;bin</span><br><span class="line">export LD_LIBRARY_PATH&#x3D;$LD_LIBRARY_PATH:$&#123;CUDA_HOME&#125;&#x2F;lib64</span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~&#x2F;.bashrc   #执行命令使.bashrc文件配置生效</span><br></pre></td></tr></table></figure></div>

<p><strong>==测试CUDA是否安装成功==</strong><br>同样在<code>/home</code>根目录下执行下面的命令，测试是否成功安装CUDA，若执行完命令显示GPU的相关信息表示安装成功。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;cuda-8.0&#x2F;samples&#x2F;1_Utilities&#x2F;deviceQuery #由自己电脑目录决定</span><br><span class="line">sudo make</span><br><span class="line">sudo .&#x2F;deviceQuery</span><br></pre></td></tr></table></figure></div>

<p><strong><em>四、Cudnn安装</em></strong><br>Cudnn的安装更加简单，其实就是复制文件和建立软连接。<br><strong>==Cudnn下载==</strong><br>cudnn的下载链接如下，需要注册，然后再登录进去，选择适合自己的版本下载<br><a href="https://developer.nvidia.com/rdp/cudnn-download" target="_blank" rel="noopener">https://developer.nvidia.com/rdp/cudnn-download</a><br>我这里下载的是cudnn6.0版本的，登陆进去之后选择Archived cuDNN Releases 然后选择cudnn v6.0…for CUDA 8.0下载<br><a href="/img/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/Cudnn.jpg" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/img/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/Cudnn.jpg" class="lazyload" title></a></p>
<p><strong>==Cudnn安装==</strong><br>下载完成之后解压到<code>/home</code>目录下，文件夹重命名为cudnn6，然后执行下面的命令进行安装</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim setupcudnn.sh    #新建一个shell脚本文件，文件里面复制下面的内容进去</span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">echo &quot;remove libcudnn* file of &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;lib64&quot;</span><br><span class="line">sudo rm -rf &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;lib64&#x2F;libcudnn.s*   #删除旧版本cudnn</span><br><span class="line"></span><br><span class="line">echo &quot;copy cudnn.h to usr&#x2F;local&#x2F;cuda&#x2F;include&quot;</span><br><span class="line">sudo cp &#x2F;home&#x2F;user_name&#x2F;cudnn6&#x2F;include&#x2F;cudnn.h &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;include   #复制cudnn.h文件到&#x2F;usr&#x2F;local&#x2F;cuda&#x2F;include目录下，这里的user_name改为自己的用户名</span><br><span class="line">sudo chmod 777 -R &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;include    #对复制后的文件解除权限</span><br><span class="line"></span><br><span class="line">echo &quot;copy lib* to usr&#x2F;local&#x2F;cuda&#x2F;lib64&quot;</span><br><span class="line">sudo cp &#x2F;home&#x2F;user_name&#x2F;cudnn6&#x2F;lib64&#x2F;lib* &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;lib64    #同上</span><br><span class="line">sudo chmod 777 -R &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;lib64    #同上</span><br><span class="line"></span><br><span class="line">sudo ldconfig   #对所有的复制和解除权限操作执行生效</span><br></pre></td></tr></table></figure></div>
<p>然后保存setupcudnn.sh文件的内容，并执行下面的命令进行安装：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo bash setupcudnn.sh   #执行setupcudnn.sh脚本中的命令，安装cudnn</span><br></pre></td></tr></table></figure></div>
<p>注意：这里将安装命令写成脚本文件的好处是，后面如果要进行其他cudnn版本的安装，只要稍加修改这个脚本，然后运行就可以迅速完成安装。例如要安装cudnn7版本，下载cudnn7，解压文件重命名为cudnn7，把脚本文件里的cudnn6修改为cudnn7，然后执行sudo bash setupcudnn.sh 就完成了安装。</p>
<p><strong><em>五、Opencv安装</em></strong><br>1、从官网下载Opencv源码，我选用的是opencv-3.4.1</p>
<p>2、下载完成后解压到<code>/home</code> 文件夹下</p>
<p>3、进入opencv-3.4.1目录下，执行以下三个命令：（cmake的路径要和自己anaconda的安装路径一致）</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir build # 创建编译的文件目录</span><br><span class="line">cd build</span><br><span class="line">cmake -D PYTHON_DEFAULT_EXECUTABLE&#x3D;~&#x2F;anaconda3&#x2F;bin&#x2F;python3\</span><br><span class="line">    -D BUILD_opencv_python3&#x3D;ON\</span><br><span class="line">	-D BUILD_opencv_python2&#x3D;OFF\</span><br><span class="line">	-D PYTHON3_EXCUTABLE&#x3D;~&#x2F;anaconda3&#x2F;bin&#x2F;python3\</span><br><span class="line">	-D PYTHON3_INCLUDE_DIR&#x3D;~&#x2F;anaconda3&#x2F;include&#x2F;python3.6m\</span><br><span class="line">	-D PYTHON3_LIBRARY&#x3D;~&#x2F;anaconda3&#x2F;lib&#x2F;libpython3.6m.so.1.0\</span><br><span class="line">	-D PYTHON_NUMPY_PATH&#x3D;~&#x2F;anaconda3&#x2F;lib&#x2F;python3.6&#x2F;site-packages ..</span><br></pre></td></tr></table></figure></div>

<p>4、进行编译和安装</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make -j4  </span><br><span class="line">sudo make install  #安装</span><br></pre></td></tr></table></figure></div>

<p>5、配置环境</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit &#x2F;etc&#x2F;ld.so.conf.d&#x2F;opencv.conf</span><br></pre></td></tr></table></figure></div>
<p>在空白文件添加：<code>/usr/local/lib</code><br>使路径生效：<code>sudo ldconfig</code></p>
<p>6、配置bash</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit &#x2F;etc&#x2F;bash.bashrc</span><br></pre></td></tr></table></figure></div>
<p>在末尾添加：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PKG_CONFIG_PATH&#x3D;$PKG_CONFIG_PATH:&#x2F;usr&#x2F;local&#x2F;lib&#x2F;pkgconfig  </span><br><span class="line">export PKG_CONFIG_PATH</span><br></pre></td></tr></table></figure></div>
<p>使配置生效：<code>source /etc/bash.bashrc</code><br>更新：<code>sudo updatedb</code></p>
<p>至此按道理可以在Anaconda的Python3.6下import cv2</p>
<p>如果报错无法找到cv2模块，解决方法如下：<br><code>~/opencv-3.4.1/build/lib/python3</code>目录下将其中的cv2.cpython-36m-x86_64-linux-gnu.so复制到anaconda下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp cv2.cpython-36m-x86_64-linux-gnu.so ~&#x2F;anaconda3&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;</span><br></pre></td></tr></table></figure></div>
<p>重命名为cv2.so：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv cv2.cpython-36m-x86_64-linux-gnu.so cv2.so</span><br></pre></td></tr></table></figure></div>
<p>再次import cv2，如果报错“GLIBCXX_3.4.21’ not found”，是因为gcc库版本太老，使用conda进行安装</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install libgcc</span><br></pre></td></tr></table></figure></div>
<p>按道理应该能够顺利import</p>
<p><strong><em>六、YOLO安装测试</em></strong><br><strong>==Darknet的安装==</strong><br>yolov3是在darknet平台上实现的，darknet安装教程按照官网步骤就可以了，官网链接<a href="https://pjreddie.com/darknet/install/" target="_blank" rel="noopener">https://pjreddie.com/darknet/install/</a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;pjreddie&#x2F;darknet.git    #从github上下载darknet安装包</span><br></pre></td></tr></table></figure></div>

<p><strong>==Darknet的MakeFile配置==</strong><br>进入到下载下来的darknet文件夹下，打开Makefile，对如下几个地方进行修改<br><a href="/img/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/Makefile_1.jpg" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/img/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/Makefile_1.jpg" class="lazyload" title></a><br><a href="/img/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/Makefile_2.jpg" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/img/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/Makefile_2.jpg" class="lazyload" title></a><br>备注<br>这里的ARCH= -gencode arch=compute_61,code=[sm_61,compute_61]根据自己的GPU型号的计算能力进行设置，可以通过下面链接查找GPU的计算能力。GT940M的计算能力是5.0，所以设置为50，其他型号的对照修改吧。</p>
<p><a href="/img/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/CUDA_GPU.jpg" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/img/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/CUDA_GPU.jpg" class="lazyload" title></a></p>
<p><strong>==Darknet的编译==</strong><br>在Darknet目录下，执行</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -j8</span><br></pre></td></tr></table></figure></div>

<p><strong>==Darknet的测试==</strong><br>同样在Darknet目录下，执行</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;pjreddie.com&#x2F;media&#x2F;files&#x2F;yolov3.weights   #下载权重文件</span><br><span class="line">.&#x2F;darknet detect cfg&#x2F;yolov3.cfg yolov3.weights data&#x2F;dog.jpg  #使用下载的权重文件进行图片检测</span><br></pre></td></tr></table></figure></div>
<p>运行成功后会出现下面的图片，并在Darknet目录下生成<code>predictions.png</code>文件<br><a href="/img/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/predict.jpg" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/img/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/predict.jpg" class="lazyload" title></a></p>
<p><strong><em>七、Faster R-CNN安装测试</em></strong><br><strong>==前期准备==</strong><br>1、建立一个虚拟cunda环境：conda create -n tensorflow python=3.6，进入到tensorflow虚拟环境下<br>查看cuda的版本</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;version.txt</span><br></pre></td></tr></table></figure></div>
<p>查看cudnn版本</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;include&#x2F;cudnn.h | grepCUDNN_MAJOR -A 2</span><br></pre></td></tr></table></figure></div>
<p>根据cuda 和 cudnn版本，到tensorflow 的官网上查对应的TF版本<br><a href="https://tensorflow.google.cn/install/source" target="_blank" rel="noopener">https://tensorflow.google.cn/install/source</a><br><a href="/img/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/TensorFlow.jpg" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/img/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/TensorFlow.jpg" class="lazyload" title></a></p>
<p><strong>==环境配置==</strong><br>1、安装TensorFlow<br>从清华镜像源下载tensorflow-gpu源码进行安装，我这里使用的是cuda8+cudnn6，因此选用tensorflow-gpu-1.3版本进行安装，进入TensorFlow下载路径</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install tensorflow_gpu-1.3.0-cp36-cp36m-linux_x86_64.whl</span><br></pre></td></tr></table></figure></div>
<p>注：在安装过程中需要下载其他的依赖项，下载速度较慢，可以Ctrl+c停止安装，使用conda进行安装，之后再进行tensorflow的安装，<br>如果觉得每次Ctrl+c太麻烦，为了避免下载速度太慢，出现read time out的错误，可以修改默认下载时间：<code>pip --default-timeout=10000 install -U xxx</code>，具体方法可百度</p>
<p>2、安装其他依赖项<br>还需要安装一些依赖包：cython, opencv-python,easydict<br>如果用pip安装太慢，可以使用conda进行安装，不过easydict和opencv-python好像无法使用conda安装，只能用pip慢慢下载，同样需要修改默认时间避免超时</p>
<p><strong>==下载代码和数据==</strong><br>1、clone github的仓库</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;endernewton&#x2F;tf-faster-rcnn.git</span><br></pre></td></tr></table></figure></div>
<p>没有安装git可以直接进入github进行下载</p>
<p>2、更新GPU的架构配置，到setup.py中找到 -arch 这个参数，改成自己的GPU架构就行了</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd tf-faster-rcnn&#x2F;lib</span><br><span class="line"># Change the GPU architecture (-arch) if necessary</span><br><span class="line">vim setup.py</span><br></pre></td></tr></table></figure></div>

<p>3、链接cython 模块，注意这也是在上一步那个lib 文件夹中进行的</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br><span class="line">make</span><br><span class="line">cd ..</span><br></pre></td></tr></table></figure></div>

<p>4、安装 Python COCO API，这是为了使用COCO数据库</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd data</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;pdollar&#x2F;coco.git</span><br><span class="line">cd coco&#x2F;PythonAPI</span><br><span class="line">make</span><br><span class="line">cd ..&#x2F;..&#x2F;..</span><br></pre></td></tr></table></figure></div>

<p><strong>==运行Demo 和测试预训练模型==</strong><br>1、下载预训练模型</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Resnet101 for voc pre-trained on 07+12 set</span><br><span class="line">.&#x2F;data&#x2F;scripts&#x2F;fetch_faster_rcnn_models.sh</span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar xvf voc_0712_80k-110k.tgz</span><br></pre></td></tr></table></figure></div>
<p>2、简历预训练模型软连接</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NET&#x3D;res101</span><br><span class="line">TRAIN_IMDB&#x3D;voc_2007_trainval+voc_2012_trainval</span><br><span class="line">mkdir -p output&#x2F;$&#123;NET&#125;&#x2F;$&#123;TRAIN_IMDB&#125;</span><br><span class="line">cd output&#x2F;$&#123;NET&#125;&#x2F;$&#123;TRAIN_IMDB&#125;</span><br><span class="line">ln -s ..&#x2F;..&#x2F;..&#x2F;voc_2007_trainval+voc_2012_trainval .&#x2F;default</span><br><span class="line">cd ..&#x2F;..&#x2F;..</span><br></pre></td></tr></table></figure></div>

<p>2、运行以下代码就能测试demo了，注意是在tf-faster-rcnn 这个根文件夹中运行</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># at repository root</span><br><span class="line">GPU_ID&#x3D;0</span><br><span class="line">CUDA_VISIBLE_DEVICES&#x3D;$&#123;GPU_ID&#125; .&#x2F;tools&#x2F;demo.py</span><br></pre></td></tr></table></figure></div>
<p>注意：在测试过程中可能缺少某些模块，使用conda进行安装即可，直至不在报错<br><strong><em>参考链接</em></strong><br><a href="https://blog.csdn.net/weixin_41864878/article/details/79621210" target="_blank" rel="noopener">https://blog.csdn.net/weixin_41864878/article/details/79621210</a><br><a href="https://blog.csdn.net/zyazky/article/details/82621547" target="_blank" rel="noopener">https://blog.csdn.net/zyazky/article/details/82621547</a><br><a href="https://blog.csdn.net/phdsky/article/details/78248192" target="_blank" rel="noopener">https://blog.csdn.net/phdsky/article/details/78248192</a><br><a href="https://blog.csdn.net/Angela_qin/article/details/80921688" target="_blank" rel="noopener">https://blog.csdn.net/Angela_qin/article/details/80921688</a></p>
</div></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">环境搭建    </a></div><div class="post_share"></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/12/22/JavaSE%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/"><img class="prev_cover lazyload" data-src="/img/Java/JavaSE/cover.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>JavaSE（一）：语言基础</span></div></a></div><div class="next-post pull_right"><a href="/2018/07/16/%E8%AE%B02018%E6%9A%91%E6%9C%9F%E5%A4%8F%E4%BB%A4%E8%90%A5%E2%80%94%E2%80%94%E4%B8%9C%E5%8D%8E%E5%A4%A7%E5%AD%A6&amp;%E9%87%8D%E5%BA%86%E5%A4%A7%E5%AD%A6/"><img class="next_cover lazyload" data-src="/img/随笔/夏令营/cover.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>记2018暑期夏令营——东华大学&amp;重庆大学</span></div></a></div></nav></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By 特立独型</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="/js/tw_cn.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>